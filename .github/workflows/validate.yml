# APL Registry - PR Validation
#
# Validates package templates on pull requests by running
# apl-pkg check against the registry.

name: Validate Templates

on:
  pull_request:
    paths:
      - 'packages/**'

jobs:
  validate:
    name: Check Templates
    runs-on: macos-latest
    timeout-minutes: 15
    steps:
      - name: Checkout registry
        uses: actions/checkout@v4

      - name: Checkout apl (for apl-pkg binary)
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository_owner }}/apl
          path: apl

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Rust Cache
        uses: swatinem/rust-cache@v2
        with:
          workspaces: apl -> target

      - name: Build apl-pkg
        working-directory: apl
        run: cargo build --release -p apl-pkg

      - name: Validate Registry
        run: ./apl/target/release/apl-pkg --registry packages check
